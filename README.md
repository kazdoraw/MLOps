# MLOps HW1: ML Pipeline с DVC и MLflow

## Цель проекта

Создание воспроизводимого ML-pipeline для **бинарной классификации медицинских консультаций**: определение необходимости очного визита к врачу на основе текста диалога пациент-врач из датасета ChatDoctor.

### Задача классификации

- **Класс 0**: Консультация может быть решена онлайн
- **Класс 1**: Требуется офлайн-визит к врачу

Метки генерируются автоматически на основе ключевых фраз в ответах врачей (visit, consult, emergency, etc.)

## Структура проекта

```
HW1/
├── data/
│   ├── raw/              # Исходные данные из Kaggle (версионируются через DVC)
│   └── processed/        # Обработанные данные train/test (версионируются через DVC)
├── src/
│   ├── prepare.py        # Парсинг JSON/CSV, генерация меток, train/test split
│   └── train.py          # TF-IDF + RandomForest/LogisticRegression + MLflow
├── models/               # Сохраненные модели и графики (версионируются через DVC)
├── dvc.yaml              # Описание пайплайна DVC (2 стадии)
├── params.yaml           # Гиперпараметры модели и TF-IDF
├── requirements.txt      # Зависимости проекта
└── README.md             # Документация
```

## Как запустить

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Инициализируйте DVC (если еще не сделано):
```bash
dvc init
```

3. Загрузите данные (если настроен remote):
```bash
dvc pull
```

4. Запустите пайплайн обучения:
```bash
dvc repro
```

5. Запустите MLflow UI для просмотра экспериментов:
```bash
mlflow ui --backend-store-uri sqlite:///mlflow.db
```

Откройте браузер по адресу: http://127.0.0.1:5000

## Описание пайплайна

Пайплайн состоит из двух основных стадий:

1. **prepare** (src/prepare.py):
   - Загрузка датасета ChatDoctor (JSON/CSV)
   - Парсинг структуры: извлечение текстов пациентов и врачей
   - Генерация меток: автоматическая разметка на основе ключевых фраз
   - Формирование датасета: [text, label]
   - Train/test split (80/20) со стратификацией
   - Сохранение в data/processed/

2. **train** (src/train.py):
   - Загрузка обработанных данных
   - Построение Pipeline:
     * TfidfVectorizer (max_features=5000, ngrams=(1,2))
     * Классификатор (RandomForest или LogisticRegression)
   - Обучение модели
   - Оценка метрик: accuracy, precision, recall, f1-score
   - Создание confusion matrix
   - Логирование всех параметров/метрик/артефактов в MLflow
   - Сохранение модели в models/

## Технологии

- **DVC** - версионирование данных и пайплайнов
- **MLflow** - трекинг экспериментов и моделей
- **scikit-learn** - машинное обучение
- **pandas** - обработка данных

## MLflow UI

После запуска `mlflow ui` интерфейс доступен по адресу:
- http://127.0.0.1:5000

В UI можно увидеть:
- Параметры модели
- Метрики качества
- Артефакты (модели, графики)
